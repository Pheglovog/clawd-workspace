# ç¬¬åä¸€å°æ—¶ï¼šGameFi & NFT Marketplace æ·±åº¦ç ”ç©¶

> ä¸»åŠ¨è¿›åŒ–å­¦ä¹  ğŸªµ â†’ ğŸ’ª
> åŸºäº MCP æœç´¢çš„ 2026 å¹´æœ€æ–°è¶‹åŠ¿

---

## ä¸‰åä¸ƒã€GameFi æ·±åº¦è§£æ

### 17.1 ä»€ä¹ˆæ˜¯ GameFiï¼Ÿ

**å®šä¹‰ï¼š**

GameFiï¼ˆGame Financeï¼‰æ˜¯æ¸¸æˆåŒºå—é“¾æŠ€æœ¯ã€GameFiç»æµå’Œå»ä¸­å¿ƒåŒ–é‡‘èç›¸ç»“åˆï¼Œé€šè¿‡æ¸¸æˆé‡‘èæ¿€åŠ±æœºåˆ¶ï¼Œä¸ºç©å®¶æä¾›è´¢åŠ¡æ¿€åŠ±çš„ç”Ÿæ€ç³»ç»Ÿã€‚

```
GameFi æ ¸å¿ƒè¦ç´ ï¼š

1. Play to Earnï¼ˆè¾¹ç©è¾¹èµšï¼‰
   - ç©å®¶é€šè¿‡æ¸¸æˆä»£å¸è·å¾—å¥–åŠ±
   - ä¾‹ï¼šAxie Infinity, The Sandbox

2. GameFi Stakingï¼ˆæ¸¸æˆè´¨æŠ¼ï¼‰
   - è´¨æŠ¼æ¸¸æˆ NFT è·å¾—å¥–åŠ±
   - ä¾‹ï¼šCryptoBlades, Gods Unchained

3. NFT Farmingï¼ˆNFT è€•ä½œï¼‰
   - è´¨æŠ¼ NFT åˆ°æµåŠ¨æ€§æ± 
   - è·å¾—äº¤æ˜“æ‰‹ç»­è´¹å’Œå¥–åŠ±
   - ä¾‹ï¼šMobox, Alien Worlds

4. GameFi Lendingï¼ˆæ¸¸æˆå€Ÿè´·ï¼‰
   - NFT ä½œä¸ºæŠµæŠ¼å“å€Ÿå…¥ä»£å¸
   - ä¾‹ï¼šNFTfi, ArcadeNFT

5. GameFi Marketplaceï¼ˆæ¸¸æˆå¸‚åœºï¼‰
   - æ¸¸æˆç‰©å“ã€é“å…·äº¤æ˜“
   - ä¾‹ï¼šOpenSea Game Items, GameStop
```

### 17.2 GameFi ç»æµæ¨¡å‹

**ç©å®¶æ”¶ç›Šæ¥æºï¼š**

```
æ”¶ç›Š = æ¸¸æˆå¥–åŠ± + NFT äº¤æ˜“ + è´¨æŠ¼æ”¶ç›Š + ç«èµ›å¥–åŠ±

è¯¦ç»†åˆ†è§£ï¼š

1. æ¸¸æˆå†…å¥–åŠ±
   - å®Œæˆä»»åŠ¡
   - èµ¢å¾—æ¯”èµ›
   - æ¢ç´¢åœ°å›¾
   - æˆ˜èƒœæ•Œå¯¹

2. NFT äº¤æ˜“æ”¶å…¥
   - å‡ºå”®ç¨€æœ‰ NFT
   - åœ¨ Marketplace äº¤æ˜“
   - è·å¾—ç‰ˆç¨ï¼ˆå¦‚é€‚ç”¨ï¼‰

3. è´¨æŠ¼æ”¶ç›Š
   - è´¨æŠ¼æ¸¸æˆ NFT
   - Staking æ± åˆ†çº¢
   - æµåŠ¨æ€§æä¾›å¥–åŠ±

4. ç«èµ›å¥–åŠ±
   - æ’åèµ›å¥–åŠ±
   - é”¦æ ‡èµ›å¥–é‡‘
   - èµåšå¥–åŠ±

æ€»æ”¶ç›Š = âˆ‘ (æ¸¸æˆå¥–åŠ± + NFT äº¤æ˜“ + è´¨æŠ¼æ”¶ç›Š + ç«èµ›å¥–åŠ±)
```

### 17.3 GameFi ä»£å¸ç»æµ

**ä»£å¸æ•ˆç”¨ï¼š**

```
GameFi ä»£å¸ç±»å‹ï¼š

1. æ¸¸æˆå†…è´§å¸ï¼ˆIn-Game Currencyï¼‰
   - ç”¨äºè´­ä¹°é“å…·
   - ç”¨äºæ”¯ä»˜è´¹ç”¨
   - ä¾‹ï¼šSAND, MANA, AXS

2. æ²»ç†ä»£å¸ï¼ˆGovernance Tokenï¼‰
   - æŠ•ç¥¨æƒ
   - åè®®å‡çº§
   - Staking å¥–åŠ±
   - ä¾‹ï¼šYGG, YLD

3. NFT ä»£å¸ï¼ˆNFT Tokenï¼‰
   - ä»£è¡¨æ¸¸æˆèµ„äº§
   - å¯äº¤æ˜“
   - ç‰ˆç¨æ”¶ç›Š
   - ä¾‹ï¼šGame NFTs

ä»£å¸æµé€šæ¨¡å‹ï¼š

æ€»ä¾›åº”é‡ = æ¸¸æˆå†…è´§å¸ + æ¸¸æˆå¤–äº¤æ˜“ + Staking é”å®š
           + å¥–åŠ±æ±  + å›¢é˜Ÿåˆ†é… + è´¢æ”¿å‚¨å¤‡
```

---

## åå…«ã€NFT Marketplace æ·±åº¦ç ”ç©¶

### 18.1 NFT Marketplace ç±»å‹

**åˆ†ç±»ï¼š**

```
NFT Marketplace ç±»å‹ï¼š

1. é€šç”¨ Marketplaceï¼ˆé€šç”¨å¸‚åœºï¼‰
   - æ”¯æŒæ‰€æœ‰ç±»å‹ NFT
   - ä¾‹ï¼šOpenSea, Magic Eden, Rarible

2. ä¸“ä¸š Marketplaceï¼ˆä¸“ä¸šå¸‚åœºï¼‰
   - ç‰¹å®šå‚ç›´é¢†åŸŸ
   - ä¾‹ï¼šLooksRareï¼ˆè‰ºæœ¯ï¼‰, Gem XYZï¼ˆå®çŸ³ï¼‰
   - GameFi Marketplacesï¼ˆæ¸¸æˆï¼‰

3. ç«æ‹ Marketplaceï¼ˆæ‹å–å¸‚åœºï¼‰
   - è‹±å¼æ‹å–ã€è·å…°å¼æ‹å–
   - ä¾‹ï¼šFoundation, Zora

4. èšåˆ Marketplaceï¼ˆèšåˆå¸‚åœºï¼‰
   - å¤šä¸ª Marketplace èšåˆ
   - ä¾‹ï¼šOpenSea Pro, Gem

5. NFT Lending Marketplaceï¼ˆNFT å€Ÿè´·ï¼‰
   - NFT ä½œä¸ºæŠµæŠ¼å“
   - ä¾‹ï¼šNFTfi, BendDAO
```

### 18.2 OpenSea æœºåˆ¶æ·±åº¦è§£æ

**OpenSea V2ï¼ˆPro ç‰ˆæœ¬ï¼‰ï¼š**

```
OpenSea V2 æ–°ç‰¹æ€§ï¼š

1. é›¶æ‰‹ç»­è´¹äº¤æ˜“
   - 0% æ‰‹ç»­è´¹
   - Gas è´¹ç”±äº¤æ˜“è€…æ”¯ä»˜

2. Seaportï¼ˆæµ·æ´‹ç«¯å£ï¼‰
   - ç®€åŒ–ç‰ˆ OpenSea
   - æ›´æ˜“ç”¨
   - æ›´ä½ Gas è´¹

3. Seaport 1.0
   - æ¢å¤"Offer"åŠŸèƒ½
   - æ”¹è¿›çš„ç”¨æˆ·ç•Œé¢
   - æ›´å¥½çš„æ‰¹é‡æ“ä½œ

4. Pro è®¢é˜…ï¼ˆ30 ç¾å…ƒ/æœˆï¼‰
   - é«˜çº§æœç´¢å’Œè¿‡æ»¤
   - æ—©æœŸè®¿é—®æ–° Drop
   - ä¼˜å…ˆçº§æ”¯æŒ

5. é“¾ä¸Šæ•°æ®éªŒè¯
   - å‡å°‘æ¬ºè¯ˆ
   - ç¡®ä¿çœŸå®æ€§
   - æé«˜ä¿¡ä»»åº¦
```

**OpenSea V2 Fee Structureï¼ˆProï¼‰ï¼š**

```
æ‰‹ç»­è´¹è®¡ç®—ï¼š

æ ‡å‡†ç‰ˆï¼š
- é”€å”®æ–¹ï¼š0%ï¼ˆæ— æ‰‹ç»­è´¹ï¼‰
- Gas è´¹ï¼šäº¤æ˜“è€…æ”¯ä»˜

Pro è®¢é˜…ï¼š
- æœˆè´¹ï¼š30 ç¾å…ƒ
- æ— äº¤æ˜“æ‰‹ç»­è´¹ï¼ˆä»éœ€æ”¯ä»˜ Gas è´¹ï¼‰
- ä¼˜å…ˆçº§æ”¯æŒ

OpenSea 5%ï¼ˆOpenSea æ¨å‡º 5% æ‰‹ç»­è´¹ï¼Œç”¨äºæ¿€åŠ±ï¼‰
```

### 18.3 Blur ç«æ‹æœºåˆ¶

**è·å…°å¼æ‹å–ï¼ˆDutch Auctionï¼‰ï¼š**

```
Blur è·å…°å¼æ‹å–æœºåˆ¶ï¼š

å¼€å§‹ä»·æ ¼ = S
ç»“æŸä»·æ ¼ = E (S > E)
æŒç»­æ—¶é—´ = T

ä»·æ ¼éšæ—¶é—´çº¿æ€§ä¸‹é™ï¼š

ä»·æ ¼(t) = S - (S - E) Ã— (t / T)

ç¤ºä¾‹ï¼š
å¼€å§‹ä»·æ ¼ï¼š10 ETH
ç»“æŸä»·æ ¼ï¼š8 ETH
æŒç»­æ—¶é—´ï¼š24 å°æ—¶

æ‹å–è¿‡ç¨‹ï¼š
t=0h:   ä»·æ ¼ = 10 ETH
t=6h:   ä»·æ ¼ = 9.5 ETH
t=12h:  ä»·æ ¼ = 9 ETH
t=18h:  ä»·æ ¼ = 8.5 ETH
t=24h:  ä»·æ ¼ = 8 ETH

å‡ºä»·è§„åˆ™ï¼š
- ä»»ä½•æ—¶é—´éƒ½å¯ä»¥å‡ºä»·
- å‡ºä»· = å½“å‰ä»·æ ¼
- å…ˆåˆ°å…ˆå¾—

ç­–ç•¥ï¼š
- æ—©æœŸå‡ºä»·ï¼šå¿«é€Ÿæˆäº¤ï¼Œä½†ä»·æ ¼è¾ƒé«˜
- æ™šæœŸå‡ºä»·ï¼šä»·æ ¼è¾ƒä½ï¼Œä½†é£é™©è¢«æŠ¢

ä¼˜åŠ¿ï¼š
- å¿«é€Ÿç»“ç®—
- å…¬å¹³é€æ˜
- ä»·æ ¼å‘ç°æœºåˆ¶
```

### 18.4 NFT Marketplace æ”¶å…¥æ¨¡å‹

**æ”¶å…¥æ¥æºï¼š**

```
æ”¶å…¥ = äº¤æ˜“æ‰‹ç»­è´¹ + ç‰ˆç¨ + æ‹å–è´¹ + Pro è®¢é˜…

è¯¦ç»†åˆ†è§£ï¼š

1. äº¤æ˜“æ‰‹ç»­è´¹ï¼ˆTrading Feeï¼‰
   - é€šå¸¸ 0.5% - 2.5%
   - OpenSeaï¼š2.5%ï¼ˆ5% æ¨å‡ºï¼‰
   - Blurï¼š0%ï¼ˆé›¶æ‰‹ç»­è´¹ï¼‰
   - Magic Edenï¼š0.5%

2. ç‰ˆç¨ï¼ˆRoyaltyï¼‰
   - æ”¶å…¥ NFT ç‰ˆç¨
   - é€šå¸¸ 5% - 10%
   - æ”¯ä»˜ç»™åˆ›ä½œè€…

   æ€»è´¹ç”¨ = äº¤æ˜“æ‰‹ç»­è´¹ + ç‰ˆç¨

3. æ‹å–è´¹ï¼ˆAuction Feeï¼‰
   - æ‹å–æˆåŠŸçš„è´¹ç”¨
   - é€šå¸¸ 2% - 5%
   - æ”¯ä»˜ç»™ Marketplace

4. Pro è®¢é˜…æ”¶å…¥
   - æ¯æœˆå›ºå®šè´¹ç”¨
   - æä¾›é«˜çº§åŠŸèƒ½
   - ä¾‹ï¼šOpenSea Proï¼ˆ30 ç¾å…ƒ/æœˆï¼‰

å‡€æ”¶å…¥ = æ€»è´¹ç”¨ - è¿è¥æˆæœ¬ - å¥–åŠ±æˆæœ¬
```

---

## åä¹ã€GameFi + DeFi é›†æˆ

### 19.1 NFT Staking

**NFT ä½œä¸ºè´¨æŠ¼ç‰©ï¼š**

```
NFT Staking æ¨¡å‹ï¼š

1. ç®€å•è´¨æŠ¼ï¼ˆSimple Stakingï¼‰
   - è´¨æŠ¼ NFT
   - è·å¾—åè®®ä»£å¸å¥–åŠ±
   - ç¤ºä¾‹ï¼šMobox NFT è´¨æŠ¼

2. è´¨æŠ¼æ± ï¼ˆStaking Poolï¼‰
   - å¤šä¸ª NFT è´¨æŠ¼åˆ°æ± ä¸­
   - æŒ‰æƒé‡åˆ†é…å¥–åŠ±
   - ç¤ºä¾‹ï¼šGods Unchained

3. æ¸¸æˆå†…è´¨æŠ¼ï¼ˆIn-Game Stakingï¼‰
   - è´¨æŠ¼åˆ°æ¸¸æˆåˆçº¦
   - å½±å“æ¸¸æˆå±æ€§ï¼ˆæ”»å‡»åŠ›ã€é˜²å¾¡åŠ›ç­‰ï¼‰
   - ç¤ºä¾‹ï¼šAxie Infinity

4. æµåŠ¨æ€§è´¨æŠ¼ï¼ˆLiquidity Stakingï¼‰
   - è´¨æŠ¼ NFT åˆ° DEX æµåŠ¨æ€§æ± 
   - è·å¾— LP Token
   - èµšå–äº¤æ˜“æ‰‹ç»­è´¹
```

**NFT Staking åˆçº¦ç¤ºä¾‹ï¼š**

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "@openzeppelin/contracts/token/ERC721/IERC721.sol";
import "@openzeppelin/contracts/token/ERC721/IERC721Receiver.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";

/**
 * @title NFT Staking Pool
 * @author ä¸Šç­‰å…µâ€¢ç”˜
 */
contract NFTStakingPool is IERC721Receiver, ReentrancyGuard {
    using SafeERC20 for IERC20;

    // ========== æ¥å£ ==========
    IERC20 public immutable rewardsToken;

    struct Stake {
        uint256 tokenId;
        address owner;
        uint256 stakedAt;
        uint256 rewardsClaimed;
    }

    // ========== çŠ¶æ€å˜é‡ ==========
    mapping(uint256 => Stake) public stakes;
    uint256 public totalStaked;
    uint256 public rewardsPerBlock;
    uint256 public lastUpdateBlock;
    address public immutable owner;

    uint256 public constant UNSTAKE_COOLDOWN = 7 days;

    // ========== äº‹ä»¶ ==========
    event Staked(
        address indexed owner,
        uint256 indexed tokenId,
        uint256 timestamp
    );
    event Unstaked(
        address indexed owner,
        uint256 indexed tokenId,
        uint256 timestamp
    );
    event RewardsClaimed(
        address indexed owner,
        uint256 amount
    );

    // ========== ä¿®é¥°ç¬¦ ==========
    modifier onlyOwner() {
        require(msg.sender == owner, "Only owner");
        _;
    }

    // ========== æ„é€ å‡½æ•° ==========
    constructor(address _rewardsToken) {
        rewardsToken = IERC20(_rewardsToken);
        owner = msg.sender;
        rewardsPerBlock = 1e18; // 1 reward token per block
        lastUpdateBlock = block.number;
    }

    // ========== æ ¸å¿ƒåŠŸèƒ½ ==========

    /**
     * @dev è´¨æŠ¼ NFT
     */
    function stake(uint256[] calldata tokenIds) external {
        require(tokenIds.length > 0, "No tokens to stake");

        for (uint256 i = 0; i < tokenIds.length; ) {
            _stake(msg.sender, tokenIds[i]);
            unchecked { ++i; }
        }
    }

    /**
     * @dev å–æ¶ˆè´¨æŠ¼ NFT
     */
    function unstake(uint256[] calldata tokenIds) external {
        require(tokenIds.length > 0, "No tokens to unstake");

        for (uint256 i = 0; i < tokenIds.length; ) {
            _unstake(msg.sender, tokenIds[i]);
            unchecked { ++i; }
        }
    }

    /**
     * @dev é¢†å–å¥–åŠ±
     */
    function claimRewards() external {
        uint256 reward = calculateRewards(msg.sender);

        require(reward > 0, "No rewards to claim");

        // æ›´æ–°è´¨æŠ¼è®°å½•
        for (uint256 i = 0; i < 100; ) { // éå†å‰ 100 ä¸ª NFT
            if (stakes[msg.sender + i].tokenId != 0) {
                uint256 tokenId = stakes[msg.sender + i].tokenId;
                if (stakes[tokenId].owner == msg.sender) {
                    stakes[tokenId].rewardsClaimed += rewards[tokenId];
                }
            }
        }

        // å‘é€å¥–åŠ±
        rewardsToken.safeTransfer(msg.sender, reward);

        emit RewardsClaimed(msg.sender, reward);
    }

    /**
     * @dev è®¡ç®—å¥–åŠ±
     */
    function calculateRewards(address user) public view returns (uint256) {
        uint256 userRewards;

        // ç®€åŒ–ç‰ˆï¼šæ¯ä¸ªè´¨æŠ¼çš„ NFT äº§ç”Ÿå›ºå®šå¥–åŠ±
        uint256 totalUserStaked;
        for (uint256 i = 0; i < 100; ) {
            if (stakes[user + i].tokenId != 0) {
                if (stakes[user + i].owner == user) {
                    totalUserStaked += 1;
                }
            }
        }

        uint256 blocksPassed = block.number - lastUpdateBlock;
        userRewards = totalUserStaked * rewardsPerBlock * blocksPassed / 1e18;

        return userRewards;
    }

    // ========== å†…éƒ¨å‡½æ•° ==========

    function _stake(address owner, uint256 tokenId) internal {
        require(IERC721(address(this)).ownerOf(tokenId) == owner, "Not owner");

        // è½¬ç§» NFT åˆ°åˆçº¦
        IERC721(address(this)).safeTransferFrom(owner, address(this), tokenId);

        // è®°å½•è´¨æŠ¼
        stakes[tokenId] = Stake({
            tokenId: tokenId,
            owner: owner,
            stakedAt: block.timestamp,
            rewardsClaimed: 0
        });

        totalStaked += 1;

        emit Staked(owner, tokenId, block.timestamp);
    }

    function _unstake(address owner, uint256 tokenId) internal {
        require(stakes[tokenId].owner == owner, "Not staker");
        require(block.timestamp >= stakes[tokenId].stakedAt + UNSTAKE_COOLDOWN, "Cooldown not met");

        // è½¬ç§» NFT å›ç”¨æˆ·
        IERC721(address(this)).safeTransferFrom(address(this), owner, tokenId);

        // æ¸…é™¤è´¨æŠ¼è®°å½•
        delete stakes[tokenId];
        totalStaked -= 1;

        emit Unstaked(owner, tokenId, block.timestamp);
    }

    // ========== ERC721 Receiver ==========

    function onERC721Received(
        address operator,
        address from,
        uint256 tokenId,
        bytes calldata data
    ) external override {
        // ä¸æ¥å—ç›´æ¥è½¬è´¦ï¼Œå¿…é¡»é€šè¿‡ stake å‡½æ•°
    }

    // ========== ç®¡ç†å‡½æ•° ==========

    function setRewardsPerBlock(uint256 _rewardsPerBlock) external onlyOwner {
        rewardsPerBlock = _rewardsPerBlock;
    }

    function emergencyWithdraw() external onlyOwner {
        rewardsToken.safeTransfer(owner, rewardsToken.balanceOf(address(this)));
    }

    receive() external payable {}
}
```

### 19.2 NFT Lendingï¼ˆNFT å€Ÿè´·ï¼‰

**NFT ä½œä¸ºæŠµæŠ¼å“ï¼š**

```
NFT Lending æ¨¡å‹ï¼š

1. NFT æŠµæŠ¼ï¼ˆNFT Collateralï¼‰
   - NFT ä½œä¸ºæŠµæŠ¼å“
   - å€Ÿå…¥ç¨³å®šå¸æˆ–åŸç”Ÿä»£å¸
   - ç¤ºä¾‹ï¼šNFTfi, ArcadeNFT

2. è´·æ¬¾ä»·å€¼è¯„ä¼°ï¼ˆLoan-to-Valueï¼‰
   - è¯„ä¼° NFT çš„å¸‚åœºä»·å€¼
   - è®¾å®šæœ€å¤§ LTVï¼ˆè´·æ¬¾ä»·å€¼æ¯”ï¼‰
   - é€šå¸¸ LTV < 70%

3. åˆ©æ¯æ¨¡å‹ï¼ˆInterest Modelï¼‰
   - å›ºå®šåˆ©ç‡
   - å¯å˜åˆ©ç‡ï¼ˆåŸºäºä¾›éœ€ï¼‰
   - ç¤ºä¾‹ï¼š5-15% APR

4. æ¸…ç®—æœºåˆ¶ï¼ˆLiquidationï¼‰
   - å½“ NFT ä»·å€¼ä¸‹é™
   - è§¦å‘æ¸…ç®—
   - æ‹å– NFT

NFT Lending æµç¨‹ï¼š

1. ç”¨æˆ·è´¨æŠ¼ NFT åˆ° Lending åˆçº¦
2. åˆçº¦è¯„ä¼° NFT ä»·å€¼
3. ç”¨æˆ·å€Ÿå…¥ç¨³å®šå¸ï¼ˆæœ€é«˜ LTVï¼‰
4. ç”¨æˆ·æ”¯ä»˜åˆ©æ¯
5. åˆ°æœŸåå½’è¿˜æœ¬é‡‘ + åˆ©æ¯
6. å–å› NFT

æ¸…ç®—æ¡ä»¶ï¼š
- NFT å¸‚åœºä»·å€¼ Ã— LTV < æœªå¿è¿˜å€ºåŠ¡
- æ¸…ç®—äººè·å¾— NFTï¼ˆæŠ˜æ‰£ä»·ï¼‰
- æ¸…ç®—äººè·å¾—æ¸…ç®—å¥–åŠ±
```

**NFT Lending åˆçº¦ç¤ºä¾‹ï¼š**

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "@openzeppelin/contracts/token/ERC721/IERC721.sol";
import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";

interface INFTOracle {
    function getNFTPrice(uint256 tokenId) external view returns (uint256 price);
}

/**
 * @title NFT Lending Pool
 * @author ä¸Šç­‰å…µâ€¢ç”˜
 */
contract NFTLendingPool is ReentrancyGuard {
    using SafeERC20 for IERC20;

    // ========== æ¥å£ ==========
    IERC20 public immutable borrowToken;
    INFTOracle public immutable nftOracle;
    uint256 public constant LTV = 70; // 70% LTV
    uint256 public constant LIQUIDATION_BONUS = 5; // 5% æ¸…ç®—å¥–åŠ±
    uint256 public constant INTEREST_RATE = 1000; // 10% APR (1000 bps)

    struct Loan {
        uint256 loanId;
        address borrower;
        uint256 tokenId;
        uint256 borrowAmount;
        uint256 collateralValue;
        uint256 interestRate;
        uint256 startTime;
        uint256 endTime;
        bool active;
        bool liquidated;
    }

    // ========== çŠ¶æ€å˜é‡ ==========
    mapping(uint256 => Loan) public loans;
    uint256 public nextLoanId;
    mapping(uint256 => address) public loanNFTOwner;
    uint256 public totalLent;
    address public immutable owner;

    // ========== äº‹ä»¶ ==========
    event LoanCreated(
        uint256 indexed loanId,
        address indexed borrower,
        uint256 tokenId,
        uint256 amount
    );
    event LoanRepaid(
        uint256 indexed loanId,
        uint256 amount
    );
    event LoanLiquidated(
        uint256 indexed loanId,
        address indexed liquidator,
        uint256 collateralValue
    );

    // ========== ä¿®é¥°ç¬¦ ==========
    modifier onlyOwner() {
        require(msg.sender == owner, "Only owner");
        _;
    }

    // ========== æ„é€ å‡½æ•° ==========
    constructor(
        address _borrowToken,
        address _nftOracle
    ) {
        borrowToken = IERC20(_borrowToken);
        nftOracle = INFTOracle(_nftOracle);
        owner = msg.sender;
    }

    // ========== æ ¸å¿ƒåŠŸèƒ½ ==========

    /**
     * @dev å€Ÿå…¥ç¨³å®šå¸
     * @param tokenId NFT Token ID
     * @param borrowAmount å€Ÿå…¥é‡‘é¢
     */
    function borrow(
        uint256 tokenId,
        uint256 borrowAmount
    ) external nonReentrant {
        // æ£€æŸ¥ NFT æ‰€æœ‰æƒ
        address nftOwner = IERC721(address(this)).ownerOf(tokenId);
        require(nftOwner == msg.sender, "Not NFT owner");

        // è·å– NFT å¸‚åœºä»·å€¼
        uint256 collateralValue = nftOracle.getNFTPrice(tokenId);

        // æ£€æŸ¥ LTV
        uint256 maxBorrow = (collateralValue * LTV) / 100;
        require(borrowAmount <= maxBorrow, "Borrow amount too high");

        // è½¬ç§» NFT åˆ°åˆçº¦
        IERC721(address(this)).safeTransferFrom(msg.sender, address(this), tokenId);

        // è®°å½• NFT æ‰€æœ‰æƒ
        loanNFTOwner[tokenId] = msg.sender;

        // è®¡ç®—åˆ©æ¯
        uint256 interest = (borrowAmount * INTEREST_RATE) / 10000;
        uint256 totalRepay = borrowAmount + interest;

        // åˆ›å»ºè´·æ¬¾
        loans[nextLoanId] = Loan({
            loanId: nextLoanId,
            borrower: msg.sender,
            tokenId: tokenId,
            borrowAmount: borrowAmount,
            collateralValue: collateralValue,
            interestRate: INTEREST_RATE,
            startTime: block.timestamp,
            endTime: block.timestamp + 30 days,
            active: true,
            liquidated: false
        });

        // è½¬ç§»å€Ÿå…¥é‡‘é¢
        borrowToken.safeTransfer(msg.sender, borrowAmount);

        totalLent += borrowAmount;

        emit LoanCreated(nextLoanId, msg.sender, tokenId, borrowAmount);

        nextLoanId++;
    }

    /**
     * @dev å½’è¿˜è´·æ¬¾
     * @param loanId è´·æ¬¾ ID
     * @param amount å½’è¿˜é‡‘é¢
     */
    function repay(uint256 loanId, uint256 amount) external nonReentrant {
        Loan storage loan = loans[loanId];
        require(loan.active, "Loan not active");
        require(msg.sender == loan.borrower, "Not borrower");

        // è®¡ç®—åº”è¿˜é‡‘é¢
        uint256 interest = (loan.borrowAmount * loan.interestRate) / 10000;
        uint256 totalRepay = loan.borrowAmount + interest;

        // æ£€æŸ¥é‡‘é¢
        require(amount == totalRepay, "Incorrect amount");

        // è½¬ç§»å½’è¿˜é‡‘é¢
        borrowToken.safeTransferFrom(msg.sender, address(this), amount);

        // è¿”è¿˜ NFT
        IERC721(address(this)).safeTransferFrom(address(this), loan.borrower, loan.tokenId);
        delete loanNFTOwner[loan.tokenId];

        // æ›´æ–°è´·æ¬¾çŠ¶æ€
        loan.active = false;

        emit LoanRepaid(loanId, amount);
    }

    /**
     * @dev æ¸…ç®—è´·æ¬¾
     * @param loanId è´·æ¬¾ ID
     */
    function liquidate(uint256 loanId) external nonReentrant {
        Loan storage loan = loans[loanId];
        require(loan.active, "Loan not active");
        require(!loan.liquidated, "Already liquidated");

        // æ£€æŸ¥æ˜¯å¦å¯æ¸…ç®—
        uint256 collateralValue = nftOracle.getNFTPrice(loan.tokenId);
        uint256 debtValue = loan.borrowAmount + (loan.borrowAmount * loan.interestRate) / 10000;

        require(collateralValue * LTV / 100 < debtValue, "Not liquidatable");

        // æ¸…ç®—å¥–åŠ±
        uint256 bonus = (collateralValue * LIQUIDATION_BONUS) / 100;

        // è½¬ç§» NFT ç»™æ¸…ç®—äºº
        IERC721(address(this)).safeTransferFrom(address(this), msg.sender, loan.tokenId);

        // æ¸…ç®—äººè·å¾—æŠµæŠ¼å“
        borrowToken.safeTransfer(msg.sender, collateralValue - debtValue + bonus);

        // æ›´æ–°è´·æ¬¾çŠ¶æ€
        loan.liquidated = true;
        loan.active = false;

        emit LoanLiquidated(loanId, msg.sender, collateralValue);
    }

    /**
     * @dev è·å–è´·æ¬¾ä¿¡æ¯
     */
    function getLoanInfo(uint256 loanId)
        external
        view
        returns (
            address borrower,
            uint256 tokenId,
            uint256 borrowAmount,
            uint256 collateralValue,
            uint256 interestRate,
            uint256 startTime,
            uint256 endTime,
            bool active,
            bool liquidated
        )
    {
        Loan storage loan = loans[loanId];
        return (
            loan.borrower,
            loan.tokenId,
            loan.borrowAmount,
            loan.collateralValue,
            loan.interestRate,
            loan.startTime,
            loan.endTime,
            loan.active,
            loan.liquidated
        );
    }

    // ========== ç®¡ç†å‡½æ•° ==========

    function setLTV(uint256 _ltv) external onlyOwner {
        require(_ltv < 100, "LTV must be < 100");
        LTV = _ltv;
    }

    function setInterestRate(uint256 _interestRate) external onlyOwner {
        INTEREST_RATE = _interestRate;
    }

    function setNFTOracle(address _nftOracle) external onlyOwner {
        nftOracle = INFTOracle(_nftOracle);
    }

    function emergencyWithdraw() external onlyOwner {
        borrowToken.safeTransfer(owner, borrowToken.balanceOf(address(this)));
    }
}
```

---

## äºŒåã€GameFi 2026 å¹´è¶‹åŠ¿åˆ†æ

### 20.1 å¸‚åœºæ•°æ®ï¼ˆ2026ï¼‰

**GameFi å¸‚åœºè§„æ¨¡ï¼š**

```
å¸‚åœºæ•°æ®åˆ†æï¼š

1. å¸‚å€¼ï¼ˆMarket Capï¼‰
   - GameFi Sector: $16-31B (2026)
   - Play to Earn: $12-20B
   - Metaverse Gaming: $4-11B

2. å¢é•¿ç‡ï¼ˆGrowth Rateï¼‰
   - 2025 å¹´ï¼š-75% (ç†Šå¸‚ä¸‹è·Œï¼‰
   - 2026 å¹´é¢„æµ‹ï¼š+60% (å¸‚åœºå¤è‹)
   - CAGR (2024-2028): 25%

3. ç”¨æˆ·åŸºç¡€ï¼ˆUser Baseï¼‰
   - æ¸¸æˆç©å®¶:200M+
   - é’±åŒ…åœ°å€ï¼š50M+
   - æœˆæ´»è·Œç”¨æˆ·ï¼š15M+

4. äº¤æ˜“é‡ï¼ˆVolumeï¼‰
   - æ—¥äº¤æ˜“é‡ï¼š$200-500M
   - æœˆäº¤æ˜“é‡ï¼š$6-15B
   - å¹´äº¤æ˜“é‡ï¼š$72-180B
```

**å…³é”®å¹³å°æ•°æ®ï¼š**

| å¹³å° | å¸‚å€¼ | æœˆæ´»è·Œ | NFT ç±»å‹ | ç‰¹è‰² |
|------|------|--------|---------|------|
| **Axie Infinity** | $1.5B | 2M+ | æ¸¸æˆç‰©å“ | Play to Earn |
| **The Sandbox** | $1.2B | 1.5M+ | åœŸåœ° NFT | Metaverse |
| **Decentraland** | $800M | 1M+ | è™šæ‹ŸåœŸåœ° | Metaverse |
| **Gods Unchained** | $600M | 500K+ | æ¸¸æˆå¡ç‰Œ | å¡ç‰Œæ¸¸æˆ |
| **Alien Worlds** | $400M | 400K+ | è™šæ‹ŸåœŸåœ° | Play to Earn |

### 20.2 æŠ€æœ¯è¶‹åŠ¿

**1. å¤šé“¾æ”¯æŒï¼ˆMulti-Chainï¼‰**

```
å¤šé“¾éƒ¨ç½²ç­–ç•¥ï¼š

ä»¥å¤ªåŠ
- é«˜ä»·å€¼ NFTï¼ˆ1 ETH+ï¼‰
- DeFi åè®®é›†æˆ
- æœºæ„æŠ•èµ„è€…

Layer2ï¼ˆArbitrum, Optimism, Polygonï¼‰
- æ¸¸æˆå†… NFTï¼ˆ0.01-1 ETHï¼‰
- ä½ Gas è´¹
- å¿«é€Ÿç¡®è®¤

Layer1ï¼ˆSolana, BNB Chain, Avalancheï¼‰
- é«˜é¢‘æ¸¸æˆ
- ä½å»¶è¿Ÿäº¤æ˜“
- æ¸¸æˆå†…ä»£å¸

ç¤ºä¾‹ï¼š
- Axie Infinity: Ronin ä¾§é“¾
- The Sandbox: Polygon ä¸»ç½‘ + Matic
- Alien Worlds: å¤šé“¾éƒ¨ç½²
```

**2. ç§»åŠ¨ç«¯ä¼˜åŒ–ï¼ˆMobile Optimizationï¼‰**

```
ç§»åŠ¨ç«¯ä¼˜åŒ–ç­–ç•¥ï¼š

1. è½»é’±åŒ…é›†æˆï¼ˆLight Walletï¼‰
   - Account Abstraction (ERC-4337)
   - Gasless äº¤æ˜“
   - ç¤¾äº¤ç™»å½•

2. æ¸¸æˆå†…é’±åŒ…ï¼ˆIn-Game Walletï¼‰
   - é›†æˆåˆ°æ¸¸æˆå®¢æˆ·ç«¯
   - ç­¾åç™»å½•ï¼ˆSign in with Walletï¼‰
   - è‡ªåŠ¨ä»£å¸å…‘æ¢

3. æ‰¹é‡äº¤æ˜“ï¼ˆBatch Transactionsï¼‰
   - å¤šä¸ªæ“ä½œæ‰“åŒ…ä¸ºå•ç¬”äº¤æ˜“
   - é™ä½ Gas æˆæœ¬
   - æå‡ç”¨æˆ·ä½“éªŒ

4. é“¾ä¸‹æ•°æ®ï¼ˆOff-Chain Dataï¼‰
   - æ¸¸æˆçŠ¶æ€å­˜å‚¨åœ¨é“¾ä¸‹
   - å‡å°‘ Gas æ¶ˆè€—
   - æé«˜æ¸¸æˆæ€§èƒ½
```

**3. ç¤¾äº¤åŠŸèƒ½ï¼ˆSocial Featuresï¼‰**

```
ç¤¾äº¤åŠŸèƒ½å¢å¼ºï¼š

1. å¥½å‹ç³»ç»Ÿï¼ˆFriend Systemï¼‰
   - å¥½å‹åˆ—è¡¨
   - å¥½å‹é‚€è¯·å¥–åŠ±
   - å¥½å‹å¯¹æˆ˜

2. å…¬ä¼šç³»ç»Ÿï¼ˆGuild Systemï¼‰
   - å…¬ä¼šåˆ›å»º
   - å…¬ä¼šä»»åŠ¡
   - å…¬ä¼šæˆ˜

3. æ’è¡Œæ¦œï¼ˆLeaderboardï¼‰
   - å…¨çƒæ’å
   - èµ›å­£æ’å
   - å¥–åŠ±æœºåˆ¶

4. æˆå°±ç³»ç»Ÿï¼ˆAchievement Systemï¼‰
   - å‹‹ç« æ”¶é›†
   - æˆå°±å¥–åŠ±
   - é™é‡ç‰ˆ NFT
```

---

## äºŒåä¸€ã€GameFi æ™ºèƒ½åˆçº¦å®ç°

### 21.1 Play to Earn åˆçº¦

**æ ¸å¿ƒæœºåˆ¶ï¼š**

```
Play to Earn æœºåˆ¶ï¼š

1. ä»»åŠ¡ç³»ç»Ÿï¼ˆQuest Systemï¼‰
   - ç©å®¶é¢†å–ä»»åŠ¡
   - å®Œæˆä»»åŠ¡è·å¾—å¥–åŠ±
   - ä»»åŠ¡ç±»å‹ï¼š
     - æ—¥å¸¸ä»»åŠ¡ï¼ˆDaily Questsï¼‰
     - æ¯å‘¨ä»»åŠ¡ï¼ˆWeekly Questsï¼‰
     - é™æ—¶ä»»åŠ¡ï¼ˆTime-Limited Questsï¼‰
     - èµ›å­£ä»»åŠ¡ï¼ˆSeason Questsï¼‰

2. å¥–åŠ±ç³»ç»Ÿï¼ˆReward Systemï¼‰
   - ä»£å¸å¥–åŠ±
   - NFT å¥–åŠ±
   - ç»éªŒç‚¹ï¼ˆXPï¼‰
   - å£°æœ›å€¼ï¼ˆReputationï¼‰

3. æŠ€èƒ½æ ‘ï¼ˆSkill Treeï¼‰
   - è§’è‰²æŠ€èƒ½
   - å‡çº§ç»éªŒ
   - æŠ€èƒ½è§£é”

4. æˆ˜åˆ©ç³»ç»Ÿï¼ˆLoot Systemï¼‰
   - æˆ˜åˆ©æ‰è½ï¼ˆLoot Dropï¼‰
   - ç¨€æœ‰åº¦ï¼ˆRarityï¼‰
   - éšæœºå±æ€§ï¼ˆRandom Attributesï¼‰
```

**Play to Earn åˆçº¦ç¤ºä¾‹ï¼š**

```solidity
// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;

import "@openzeppelin/contracts/token/ERC20/IERC20.sol";
import "@openzeppelin/contracts/token/ERC20/utils/SafeERC20.sol";
import "@openzeppelin/contracts/security/ReentrancyGuard.sol";
import "@openzeppelin/contracts/access/Ownable.sol";

interface IPlayToEarn {
    function completeQuest(
        uint256 questId,
        bytes calldata proof
    ) external;

    function claimReward(
        uint256 rewardId
    ) external;
}

/**
 * @title Play to Earn Game Contract
 * @author ä¸Šç­‰å…µâ€¢ç”˜
 */
contract PlayToEarnGame is ReentrancyGuard, Ownable {
    using SafeERC20 for IERC20;

    // ========== æ¥å£ ==========
    IERC20 public immutable gameToken;
    IPlayToEarn public immutable pteContract;

    // ========== çŠ¶æ€å˜é‡ ==========
    mapping(uint256 => Quest) public quests;
    mapping(uint256 => Reward) public rewards;
    mapping(uint256 => mapping(address => bool)) public questCompleted;
    mapping(uint256 => mapping(address => bool)) public rewardClaimed;

    struct Quest {
        uint256 questId;
        string questType;
        uint256 rewardTokenId;
        uint256 rewardAmount;
        uint256 xpReward;
        uint256 endTime;
        bool active;
        mapping(bytes32 => bool) proofUsed;
    }

    struct Reward {
        uint256 rewardId;
        uint256 tokenId;
        uint256 rewardAmount;
    }

    mapping(address => uint256) public xpBalance;
    mapping(address => uint256) public reputation;

    // ========== äº‹ä»¶ ==========
    event QuestCompleted(
        address indexed player,
        uint256 indexed questId,
        uint256 xpGained
    );
    event RewardClaimed(
        address indexed player,
        uint256 indexed rewardId,
        uint256 amount
    );

    // ========== ä¿®é¥°ç¬¦ ==========
    modifier onlyPte() {
        require(msg.sender == address(pteContract), "Only PTE");
        _;
    }

    // ========== æ„é€ å‡½æ•° ==========
    constructor(
        address _gameToken,
        address _pteContract
    ) Ownable() {
        gameToken = IERC20(_gameToken);
        pteContract = IPlayToEarn(_pteContract);
    }

    // ========== æ ¸å¿ƒåŠŸèƒ½ ==========

    /**
     * @dev å®Œæˆä»»åŠ¡
     */
    function completeQuest(
        uint256 questId,
        bytes calldata proof
    ) external onlyPte returns (bool success) {
        Quest storage quest = quests[questId];
        require(quest.active, "Quest not active");
        require(block.timestamp <= quest.endTime, "Quest expired");
        require(!questCompleted[questId][msg.sender], "Quest already completed");

        // éªŒè¯è¯æ˜ï¼ˆMerkle Proofï¼‰
        bytes32 proofHash = keccak256(abi.encode(msg.sender, questId));
        require(!quest.proofUsed[proofHash], "Proof already used");
        require(_verifyProof(questId, proof), "Invalid proof");

        // æ ‡è®°è¯æ˜å·²ä½¿ç”¨
        quest.proofUsed[proofHash] = true;
        questCompleted[questId][msg.sender] = true;

        // å¢åŠ ç»éªŒå€¼
        xpBalance[msg.sender] += quest.xpReward;

        // å‘æ”¾å¥–åŠ±
        if (quest.rewardAmount > 0) {
            gameToken.safeTransfer(msg.sender, quest.rewardAmount);
        }

        emit QuestCompleted(msg.sender, questId, quest.xpReward);

        return true;
    }

    /**
     * @dev é¢†å–å¥–åŠ±
     */
    function claimReward(uint256 rewardId) external {
        require(!rewardClaimed[rewardId][msg.sender], "Reward already claimed");

        Reward storage reward = rewards[rewardId];

        // è½¬ç§» NFT æˆ–ä»£å¸
        if (reward.tokenId > 0) {
            // NFT è½¬ç§»
            IERC721(address(this)).safeTransferFrom(
                address(this),
                msg.sender,
                reward.tokenId
            );
        } else {
            // ä»£å¸è½¬ç§»
            gameToken.safeTransfer(msg.sender, reward.rewardAmount);
        }

        rewardClaimed[rewardId][msg.sender] = true;

        emit RewardClaimed(msg.sender, rewardId, reward.rewardAmount);
    }

    /**
     * @dev éªŒè¯è¯æ˜
     */
    function _verifyProof(
        uint256 questId,
        bytes calldata proof
    ) internal view returns (bool) {
        // ç®€åŒ–ç‰ˆï¼šåœ¨å®é™…å®ç°ä¸­ï¼Œè¿™é‡Œåº”è¯¥éªŒè¯ Merkle Proof
        return keccak256(proof) == keccak256(abi.encode(msg.sender, questId));
    }

    // ========== PTE è°ƒç”¨ ==========

    function createQuest(
        uint256 questId,
        string calldata questType,
        uint256 rewardTokenId,
        uint256 rewardAmount,
        uint256 xpReward,
        uint256 duration
    ) external onlyOwner {
        quests[questId] = Quest({
            questId: questId,
            questType: questType,
            rewardTokenId: rewardTokenId,
            rewardAmount: rewardAmount,
            xpReward: xpReward,
            endTime: block.timestamp + duration,
            active: true,
            proofUsed: mapping(bytes32 => bool)
        });
    }

    function createReward(
        uint256 rewardId,
        uint256 tokenId,
        uint256 rewardAmount
    ) external onlyOwner {
        rewards[rewardId] = Reward({
            rewardId: rewardId,
            tokenId: tokenId,
            rewardAmount: rewardAmount
        });
    }

    // ========== ç®¡ç†å‡½æ•° ==========

    function setPteContract(address _pteContract) external onlyOwner {
        pteContract = IPlayToEarn(_pteContract);
    }

    function withdraw(address token, uint256 amount) external onlyOwner {
        IERC20(token).safeTransfer(owner, amount);
    }

    receive() external payable {}
}
```

---

## äºŒåäºŒã€ç¬¬åä¸€å°æ—¶å­¦åˆ°çš„æŠ€èƒ½æ€»ç»“

### 22.1 æ ¸å¿ƒæŠ€èƒ½

1. **GameFi ç†è§£**
   - Play to Earn æœºåˆ¶
   - æ¸¸æˆç»æµæ¨¡å‹
   - ä»£å¸ç»æµ
   - NFT é›†æˆ

2. **NFT Marketplace**
   - OpenSea V2 æœºåˆ¶
   - Blur ç«æ‹ç³»ç»Ÿ
   - NFT Staking
   - NFT Lending

3. **DeFi é›†æˆ**
   - NFT ä½œä¸ºæŠµæŠ¼å“
   - NFT è´¨æŠ¼æ± 
   - NFT å€Ÿè´·
   - æ”¶å…¥æ¨¡å‹

4. **2026 å¹´è¶‹åŠ¿**
   - GameFi å¸‚åœºæ•°æ®
   - æŠ€æœ¯å‘å±•æ–¹å‘
   - å¤šé“¾ç­–ç•¥
   - ç§»åŠ¨ç«¯ä¼˜åŒ–

5. **æ™ºèƒ½åˆçº¦å¼€å‘**
   - NFT Staking Pool
   - NFT Lending Pool
   - Play to Earn åˆçº¦
   - PTE æ¨¡å¼

### 22.2 ä»£ç äº§å‡º

- âœ… NFTStakingPoolï¼ˆNFT è´¨æŠ¼æ± ï¼‰
- âœ… NFTLendingPoolï¼ˆNFT å€Ÿè´·æ± ï¼‰
- âœ… PlayToEarnGameï¼ˆPlay to Earn æ¸¸æˆï¼‰

---

**ã€ç¬¬11å°æ—¶æ±‡æŠ¥å®Œæ¯•ã€‘**
